<div class="page-container">
    <h1>Meu Perfil</h1>
    
    <div *ngIf="loading" class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
    
    <div *ngIf="!loading" class="perfil-container">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Informações Pessoais</mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <form [formGroup]="perfilForm" (ngSubmit)="onSubmitPerfil()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nome</mat-label>
              <input matInput formControlName="nome" required>
              <mat-error *ngIf="perfilForm.get('nome')?.hasError('required')">
                Nome é obrigatório
              </mat-error>
              <mat-error *ngIf="perfilForm.get('nome')?.hasError('maxlength')">
                Nome deve ter no máximo 100 caracteres
              </mat-error>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nome de usuário</mat-label>
              <input matInput formControlName="username" required>
              <mat-error *ngIf="perfilForm.get('username')?.hasError('required')">
                Nome de usuário é obrigatório
              </mat-error>
              <mat-error *ngIf="perfilForm.get('username')?.hasError('minlength')">
                Nome de usuário deve ter pelo menos 4 caracteres
              </mat-error>
              <mat-error *ngIf="perfilForm.get('username')?.hasError('maxlength')">
                Nome de usuário deve ter no máximo 50 caracteres
              </mat-error>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" type="email" required>
              <mat-error *ngIf="perfilForm.get('email')?.hasError('required')">
                Email é obrigatório
              </mat-error>
              <mat-error *ngIf="perfilForm.get('email')?.hasError('email')">
                Formato de email inválido
              </mat-error>
            </mat-form-field>
            
            <div class="form-actions">
              <button mat-raised-button color="primary" type="submit" [disabled]="perfilForm.invalid || submitting">
                <mat-spinner diameter="20" *ngIf="submitting" style="display: inline-block;"></mat-spinner>
                Salvar alterações
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="senha-card">
        <mat-card-header>
          <mat-card-title>Alterar Senha</mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <form [formGroup]="senhaForm" (ngSubmit)="onSubmitSenha()">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Senha atual</mat-label>
              <input matInput formControlName="senhaAtual" type="password" required>
              <mat-error *ngIf="senhaForm.get('senhaAtual')?.hasError('required')">
                Senha atual é obrigatória
              </mat-error>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nova senha</mat-label>
              <input matInput formControlName="novaSenha" type="password" required>
              <mat-error *ngIf="senhaForm.get('novaSenha')?.hasError('required')">
                Nova senha é obrigatória
              </mat-error>
              <mat-error *ngIf="senhaForm.get('novaSenha')?.hasError('minlength')">
                Nova senha deve ter pelo menos 6 caracteres
              </mat-error>
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirmar nova senha</mat-label>
              <input matInput formControlName="confirmacaoSenha" type="password" required>
              <mat-error *ngIf="senhaForm.get('confirmacaoSenha')?.hasError('required')">
                Confirmação de senha é obrigatória
              </mat-error>
              <mat-error *ngIf="senhaForm.get('confirmacaoSenha')?.hasError('notMatch')">
                As senhas não conferem
              </mat-error>
            </mat-form-field>
            
            <div class="form-actions">
              <button mat-raised-button color="primary" type="submit" [disabled]="senhaForm.invalid || changingPassword">
                <mat-spinner diameter="20" *ngIf="changingPassword" style="display: inline-block;"></mat-spinner>
                Alterar senha
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
  </div>